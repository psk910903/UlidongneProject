<!DOCTYPE html>
<html
  lang="ko"
  xmlns:th="http://www.thymeleaf.org"
  xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
>
  <head>
    <title>모임 정보</title>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT"
      crossorigin="anonymous"
    />
    <!--    <link href="/src/main/resources/static/css/home.css" rel="stylesheet" />-->
    <script src="https://code.jquery.com/jquery-3.6.3.min.js"></script>
    <link rel="stylesheet" href="/css/home.css" />
    <style>
      .header {
        padding: 10px 16px;
        display: flex;
        justify-content: center;
      }
      .classImg2 {
        width: 100%;
        height: 200px;
        object-fit: cover;
      }
      .classImg {
        object-fit: cover;
        max-width: 100%;
        height: auto;
      }
      .memberInfo {
        display: flex;
        padding-left: 5%;
      }
      .memberImg {
        margin-top: 16px;
        width: 60px;
        height: 60px;
        border-radius: 100%;
      }
      .img-wrap {
        position: relative;
      }
      .crown {
        position: absolute;
        width: 30px;
        top: 7px;
        left: 33px;
      }
      .join-btn-wrap {
        height: 90px;
        display: flex;
        justify-content: center;
        width: 100%;
        padding: 20px;
      }
      .join-btn {
        display: none;
        padding: 0 40%;
        font-size: 20px;
        font-weight: bold;
        width: 100%;
      }
      .outBtn {
        display: none;
        font-size: 20px;
        font-weight: bold;
        width: 100%;
      }
      .red {
        color: #dc3545;
        padding-bottom: 0;
      }
      .meeting-card {
        margin-top: 30px;
      }
      .meeting-card-info {
        display: flex;
      }
      .meeting-card-date {
        display: flex;
        flex-direction: column;
        justify-content: center;
        text-align: center;
        margin: 10px 0;
        padding: 15px;
        font-weight: bold;
        font-size: 20px;
        border: 1px solid #d0d0d0;
        border-radius: 15px;
      }
      .meeting-card-info-content {
        margin: 10px;
        font-size: 18px;
        display: flex;
        flex-direction: column;
        justify-content: center;
      }
      .grey {
        color: rgb(165, 165, 165);
      }
      .meeting-card-info-content img {
        width: 20px;
        margin-right: 10px;
      }
      .join-member-img {
        display: flex;
      }
      .join-member-img img {
        margin-right: 20px;
      }
      .historyBack {
        position: absolute;
        width: 20px;
        top: 15px;
        left: 10px;
      }
      .content {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
      }
      .imgBox {
        position: relative;
        width: 48%;
        margin: 6px;
      }
      .threeDot {
        position: absolute;
        top: 10px;
        right: 5px;
      }
      .threeDot img {
        height: 25px;
      }
      .replyCount {
        position: absolute;
        bottom: 10px;
        right: 5px;
        background-color: white;
        padding: 2px 10px;
        border-radius: 15px;
        font-size: 16px;
        font-weight: bold;
      }
      .replyCountImg {
        width: 20px;
        padding-bottom: 3px;
      }
      .submit-btn-wrap {
        position: relative;
        height: 80px;
        display: flex;
        justify-content: center;
        width: 100%;
        padding: 20px 0;
      }
      .submit-btn-wrap img {
        position: absolute;
        top: 24px;
        right: 90px;
      }
      .input {
        margin-right: 10px;
        width: 85%;
        border-radius: 10px;
        background-color: #eee;
        border: none;
        padding-left: 10px;
      }
      .chatDateWrap {
        width: 100%;
        display: flex;
        justify-content: center;
      }
      .chatDate {
        margin-top: 10px;
        color: white;
        padding: 4px 20px;
        background-color: #d0d0d0ad;
        border-radius: 10px;
      }
      .chatContentWrap {
        padding: 10px 0 0 20px;
        display: flex;
        flex-direction: row-reverse;
        align-items: flex-start;
      }
      .chatContentWrap2 {
        padding: 10px 20px 0 0;
        display: flex;
        flex-direction: row;
        align-items: flex-start;
      }
      .chatContentImg {
        flex-shrink: 0;
        margin: 0px 10px;
        width: 50px;
        height: 50px;
        border-radius: 100%;
      }
      .chatContentInfo {
        margin-top: 5px;
        display: flex;
        flex-direction: column;
        gap: 5px;
        align-items: flex-start;
        align-self: flex-end;
      }
      .chatContentInfo2 {
        margin-top: 5px;
        display: flex;
        flex-direction: column;
        gap: 5px;
        align-items: flex-end;
        align-self: flex-end;
      }
      .chatContentName {
        font-size: 12px;
        white-space: nowrap;
      }
      .chatContent {
        color: block;
        font-weight: bold;
        padding: 4px 10px;
        background-color: white;
        border-radius: 10px;
      }
      .chatContentDate {
        align-self: flex-end;
        white-space: nowrap;
        padding: 4px 10px;
        font-size: 11px;
        color: grey;
      }
      .page_home2 {
        background-color: #eee;
        min-height: 100%;
        padding-bottom: 30px;
        overflow: auto;
      }
      .threeDot2 {
        position: absolute;
        width: 20px;
        top: 18px;
        right: 10px;
      }
      .threeDotBackGround {
        left: 0;
        top: 0;
        overflow: hidden;
        position: fixed;
        width: 100%;
        height: 100%;
      }
      .threeDotContent-appear {
        position: absolute;
        top: 0px;
        right: 0px;
        box-shadow: -1px 1px 7px #d3d3d3;
        background-color: white;
        font-weight: 500;
        display: block;
      }
      .threeDotContent {
        padding: 10px;
        display: block;
        color: black;
        font-size: 17px;
        width: 100%;
        border: 0px;
        background-color: transparent;
        text-align: center;
      }
      .threeDotContent-disappear {
        display: none;
      }

      .outChatting {
        display: none;
      }
      .deleteChatting {
        display: none;
      }
      #outClub {
        display: none;
      }
      .acceptBtn {
        margin-top: 25px;
        width: 50px;
      }
      .tit_shop {
        width: 250px;
      }
      .desc_shop2 {
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        width: 250px;
      }
      .rejectBtn {
        width: 50px;
        margin-top: 25px;
        margin-left: 5px;
      }
      .joinRequestBtn {
        width: 150px;
      }
      .noRequest {
        font-size: 30px;
        font-weight: bold;
        margin-top: 50px;
      }
      .newMeetingBtn {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 50px;
        border-radius: 10px;
        margin: 10px 0;
        box-shadow: 2px 2px 5px 2px rgba(0, 0, 0, 0.1);
      }
      .sendTextButton {
        white-space: nowrap;
      }
    </style>
  </head>
  <body id="__next">
    <div class="group_page">
      <header>
        <div class="header tit_welcome">
          <a href="javascript: history.back();">
            <img
              class="historyBack"
              src="https://s3-doreen-bucket.s3.ap-northeast-2.amazonaws.com/icon/icons8-%EB%92%A4%EB%A1%9C-100.png"
              alt=""
            />
          </a>
          <span th:text="${club.clubName}"> 모임이름 </span>
          <div>
            <img
              class="threeDot2"
              src="https://psk-s3-bucket.s3.ap-northeast-2.amazonaws.com/icons8-%EB%A9%94%EB%89%B4-2-48+(2).png"
              alt=""
              onclick="appearMenu();"
            />
            <div id="threeDotBackGround" onclick="disappearMenu();"></div>
            <div class="threeDotContent-disappear" id="threeDotContent">
              <button href="" class="threeDotContent shareClubUrl">
                모임URL 공유하기
              </button>
              <button href="" class="threeDotContent deleteChatting">
                채팅메시지 삭제
              </button>
              <button href="" class="threeDotContent outChatting">
                채팅방 나가기
              </button>
              <button class="threeDotContent" id="outClub">
                모임 탈퇴하기
              </button>
            </div>
          </div>
        </div>
        <nav class="gnbContent">
          <div
            class="nav-button nav-appear"
            id="classContentNav"
            onclick="display('classContent')"
          >
            <div class="link_main_gnb active">정보</div>
          </div>
          <div
            class="nav-button nav-disappear"
            id="classContentPhotoNav"
            onclick="display('classContentPhoto')"
          >
            <div class="link_main_gnb active">가입 요청</div>
          </div>
          <div
            class="nav-button nav-disappear"
            id="classContentChatNav"
            onclick="display('classContentChat')"
          >
            <div class="link_main_gnb active">채팅</div>
          </div>
        </nav>
      </header>
      <!-- 정보 시작 -->
      <div class="content-appear" id="classContent">
        <div class="mArticle">
          <a href="../clubList/makeClub.html" class="imgWrapper">
            <img class="classImg2" th:src="${club.clubProfileImage}" alt="" />
          </a>
          <div class="page_home type_around">
            <div class="area_home type_top">
              <div class="tit_welcome" th:text="${club.clubName}">
                모임명입니다.
              </div>
              <div class="sub_tit_welcome">
                <span th:text="${club.clubLocation}">구로구</span>
                <span>멤버</span>
                <span class="memberNumber">46</span>
              </div>
              <div th:text="${club.clubContent}"></div>
            </div>
            <div class="area_home type_round type_thin">
              <div class="" style="width: 100%">
                <div>
                  <span class="tit_sub">모임일정</span>
                  <a
                    class="newMeetingBtn"
                    th:href="${'/club/' + club.clubIdx + '/meeting'}"
                  >
                    <div
                      style="width: 100%; text-align: center; font-weight: bold"
                    >
                      일정 만들기
                    </div>
                  </a>
                  <div class="meeting-card" th:each="meeting : ${meeting}">
                    <!-- 모임이름 -->
                    <div class="tit_sub red">
                      <span th:text="${meeting.meetingTitle}"></span>
                    </div>
                    <!-- 날짜, 장소, 금액 -->
                    <div class="meeting-card-info">
                      <div class="meeting-card-date">
                        <div><span class="day1"></span>요일</div>
                        <div style="font-size: 30px" class="howLong"></div>
                      </div>
                      <div class="meeting-card-info-content">
                        <div>
                          <img
                            src="https://psk-s3-bucket.s3.ap-northeast-2.amazonaws.com/icons8-%EB%8B%AC%EB%A0%A5-48.png"
                            alt=""
                          />
                          <span th:text="${meeting.meetingDate}"> </span>
                          (<span class="day2"></span>)
                          <span th:text="${meeting.meetingTime}"></span>~<span
                            class="endTime"
                            th:text="${meeting.meetingEndTime}"
                          ></span>
                        </div>
                        <div>
                          <img
                            src="https://psk-s3-bucket.s3.ap-northeast-2.amazonaws.com/icons8-%EC%B1%84%EC%A0%90%EC%9E%90-50.png"
                            alt=""
                          />
                          <span th:text="${meeting.meetingLocation}"></span>
                        </div>
                        <div>
                          <img
                            src="https://psk-s3-bucket.s3.ap-northeast-2.amazonaws.com/icons8-%EC%9B%90-48.png"
                            alt=""
                          />
                          <span th:text="|${meeting.meetingPay}|"></span>
                        </div>
                      </div>
                    </div>
                    <!-- 참여멤버 -->
                    <div class="grey">
                      참여멤버
                      <span
                        >( <span class="meetingMember"></span>/<span
                          th:text="${meeting.meetingLimit}"
                        ></span>
                        )</span
                      >
                    </div>
                    <!-- 멤버이미지 -->
                    <div class="join-member-img">
                      <th:block
                        th:each=" meetingMem, status : ${meeting.meetingAttend}"
                      >
                        <a
                          class="img-wrap"
                          th:href="|/member/${meetingMem.memberIdx}|"
                        >
                          <img
                            th:if="${status.count == 1}"
                            class="crown"
                            src="https://psk-s3-bucket.s3.ap-northeast-2.amazonaws.com/icons8-%EC%99%95%EA%B4%80-67.png"
                            alt=""
                          />
                          <th:block th:if="${meetingMem.memberPicture != null}">
                            <img
                              th:src="${ meetingMem.memberPicture }"
                              class="memberImg"
                              src="https://s3-doreen-bucket.s3.ap-northeast-2.amazonaws.com/icon/icons8-%EC%82%AC%EB%9E%8C-%EB%82%A8%EC%9E%90-64.png"
                              alt=""
                            />
                          </th:block>
                          <th:block
                            th:unless="${meetingMem.memberPicture != null}"
                          >
                            <img
                              class="memberImg noImg"
                              src="https://s3-doreen-bucket.s3.ap-northeast-2.amazonaws.com/icon/icons8-%EC%82%AC%EB%9E%8C-%EB%82%A8%EC%9E%90-64.png"
                              alt=""
                            />
                          </th:block>
                        </a>
                      </th:block>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="area_home type_round type_location">
              <div class="tit_sub">
                모임 멤버 (
                <span class="clubMemberNum"></span>명 )
              </div>
              <ul class="list_new">
                <th:block th:each="member, status : ${member}">
                  <li class="item_shop_card memberCard">
                    <a
                      th:href="|/member/${member.memberIdx}|"
                      class="memberInfo"
                    >
                      <div class="img-wrap">
                        <img
                          th:if="${status.count == 1}"
                          class="crown"
                          src="https://psk-s3-bucket.s3.ap-northeast-2.amazonaws.com/icons8-%EC%99%95%EA%B4%80-67.png"
                          alt=""
                        />
                        <th:block th:if="${member.memberPicture != null}">
                          <img
                            th:src="${ member.memberPicture }"
                            class="memberImg"
                            src="https://s3-doreen-bucket.s3.ap-northeast-2.amazonaws.com/icon/icons8-%EC%82%AC%EB%9E%8C-%EB%82%A8%EC%9E%90-64.png"
                            alt=""
                          />
                        </th:block>
                        <th:block th:unless="${member.memberPicture != null}">
                          <img
                            class="memberImg noImg"
                            src="https://s3-doreen-bucket.s3.ap-northeast-2.amazonaws.com/icon/icons8-%EC%82%AC%EB%9E%8C-%EB%82%A8%EC%9E%90-64.png"
                            alt=""
                          />
                        </th:block>
                      </div>
                      <div class="group_info">
                        <strong
                          class="tit_shop"
                          th:text="${member.memberName}"
                        ></strong>
                        <p
                          class="desc_shop"
                          th:text="${member.memberIntroduce}"
                        ></p>
                      </div>
                    </a>
                  </li>
                </th:block>
              </ul>
            </div>
            <div id="adfit_banner" style="position: relative"></div>
          </div>
        </div>
        <footer>
          <div class="join-btn-wrap">
            <button class="btn btn-danger join-btn">가입하기</button>
            <button class="btn btn-danger outBtn">모임 탈퇴하기</button>
          </div>
        </footer>
      </div>
      <!-- 정보 끝 -->
      <!-- 수락요청 시작 -->
      <!-- 현재 사용자가 클럽장이라면 보임 -->
      <div class="content-disappear" id="classContentPhoto">
        <div class="content">
          <ul class="list_new">
            <div class="noRequest" th:if="!${waitingMember}">
              가입 요청이 없습니다.
            </div>
            <th:block
              th:if="${waitingMember}"
              th:each="wait, status : ${waitingMember}"
            >
              <li class="item_shop_card memberCard">
                <a th:href="|/member/${wait.memberIdx}|" class="memberInfo">
                  <div class="img-wrap">
                    <img
                      th:src="${wait.memberPicture}"
                      class="memberImg"
                      alt=""
                    />
                  </div>
                  <div class="group_info">
                    <strong
                      class="tit_shop"
                      th:text="${wait.memberName}"
                    ></strong>
                    <p class="desc_shop2" th:text="${wait.memberIntroduce}"></p>
                  </div>
                </a>
                <div class="joinRequestBtn">
                  <img
                    class="acceptBtn"
                    src="https://cdn-icons-png.flaticon.com/512/5610/5610944.png"
                    alt=""
                  />

                  <img
                    class="rejectBtn"
                    src="https://cdn-icons-png.flaticon.com/512/5978/5978441.png"
                    alt=""
                  />
                </div>
              </li>
            </th:block>
          </ul>
        </div>
      </div>
      <!-- 수락요청 끝 -->
      <!-- 채팅 시작 -->
      <div id="classContentChat" class="content-disappear">
        <div class="page_home2 type_around" id="chat">
          <th:block th:each="chatting, chattingStat: ${chattingList}">
            <th:block
              th:with="lastChatMemberIdx = ${chattingStat.index == 0 ? -1 : chattingList[chattingStat.index-1].memberIdx},
                       lastChatDate = ${chattingStat.index == 0 ? -1 : #temporals.format(chattingList[chattingStat.index-1].chattingWriteTime, 'yyyy년 MM월 dd일')}"
            >
              <!-- 날짜 -->
              <div
                class="chatDateWrap"
                th:if="${lastChatDate != #temporals.format(chatting.chattingWriteTime, 'yyyy년 MM월 dd일')}"
              >
                <div
                  class="chatDate"
                  th:text="${#temporals.format(chatting.chattingWriteTime, 'yyyy년 MM월 dd일 E요일')}"
                >
                  2023년 3월 23일 목요일
                </div>
              </div>

              <!-- 채팅 -->
              <div
                th:attr="class=${chatting.memberIdx == user.memberIdx ? 'chatContentWrap' : 'chatContentWrap2'}"
              >
                <img
                  th:if="${lastChatMemberIdx != chatting.memberIdx}"
                  class="chatContentImg"
                  src="https://www.knps.or.kr/upload/contest/21/20221108082032573.jpg"
                />
                <div
                  th:unless="${lastChatMemberIdx != chatting.memberIdx}"
                  class="chatContentImg"
                ></div>
                <div
                  th:attr="class=${chatting.memberIdx == user.memberIdx ? 'chatContentInfo' : 'chatContentInfo2'}"
                >
                  <div
                    th:if="${lastChatMemberIdx != chatting.memberIdx}"
                    class="chatContentName"
                  >
                    정희진
                  </div>
                  <div
                    class="chatContent"
                    th:text="${chatting.chattingContent}"
                  >
                    채팅 내용
                  </div>
                </div>
                <div
                  class="chatContentDate"
                  th:text="${#temporals.format(chatting.chattingWriteTime, 'a hh:mm')}"
                >
                  오후 3:01
                </div>
              </div>
            </th:block>
          </th:block>

<!--          <hr />-->
<!--          <div class="chatDateWrap">-->
<!--            <div class="chatDate">2023년 3월 23일 목요일</div>-->
<!--          </div>-->
          <!-- 나: 프로필 사진이 있을 때 -->
<!--          <div class="chatContentWrap">-->
<!--            <img-->
<!--              class="chatContentImg"-->
<!--              src="https://www.knps.or.kr/upload/contest/21/20221108082032573.jpg"-->
<!--            />-->
<!--            <div class="chatContentInfo">-->
<!--              <div class="chatContentName">정희진</div>-->
<!--              <div class="chatContent">-->
<!--                Lorem ipsum dolor sit amet consectetur, adipisicing elit.-->
<!--                Adipisci corporis laborum eligendi ex consectetur esse.-->
<!--                Voluptatem fugit sit maxime totam? Autem dolor minus repellat-->
<!--                facere consectetur dicta quos quisquam minima?-->
<!--              </div>-->
<!--            </div>-->
<!--            <div class="chatContentDate">오후 3:01</div>-->
<!--          </div>-->
          <!-- 나: 프로필 사진이 없을 때 -->
<!--          <div class="chatDateWrap">-->
<!--            <div class="chatDate">2023년 3월 23일 목요일</div>-->
<!--          </div>-->
<!--          <div class="chatContentWrap">-->
<!--            <div class="chatContentImg"></div>-->
<!--            <div class="chatContentInfo">-->
<!--              <div class="chatContent">-->
<!--                Lorem ipsum dolor sit amet consectetur, adipisicing elit.-->
<!--                Adipisci corporis laborum eligendi ex consectetur esse.-->
<!--                Voluptatem fugit sit maxime totam? Autem dolor minus repellat-->
<!--                facere consectetur dicta quos quisquam minima?-->
<!--              </div>-->
<!--            </div>-->
<!--            <div class="chatContentDate">오후 3:01</div>-->
<!--          </div>-->
          <!-- 상대: 프로필 사진이 있을 때 -->
<!--          <div class="chatContentWrap2">-->
<!--            <img-->
<!--              class="chatContentImg"-->
<!--              src="https://www.knps.or.kr/upload/contest/21/20221108082032573.jpg"-->
<!--            />-->
<!--            <div class="chatContentInfo2">-->
<!--              <div class="chatContentName">정희진</div>-->
<!--              <div class="chatContent">-->
<!--                Lorem ipsum dolor sit amet consectetur adipisicing elit. Nostrum-->
<!--                accusamus aliquid quidem, doloremque perferendis eum corrupti-->
<!--                quos deserunt ad. Odit, voluptas eaque nam ea repellendus odio-->
<!--                exercitationem iure vel quidem.-->
<!--              </div>-->
<!--            </div>-->
<!--            <div class="chatContentDate">오후 3:01</div>-->
<!--          </div>-->
          <!-- 상대: 프로필 사진이 없을 때 -->
<!--          <div class="chatContentWrap2">-->
<!--            <div class="chatContentImg"></div>-->
<!--            <div class="chatContentInfo2">-->
<!--              <div class="chatContent">-->
<!--                Lorem ipsum dolor sit amet consectetur adipisicing elit.-->
<!--                Assumenda rem provident debitis recusandae nobis aspernatur-->
<!--                maxime quibusdam vitae, suscipit vel! Perferendis dolorum-->
<!--                reprehenderit eum tempora recusandae eius, architecto ea soluta?-->
<!--              </div>-->
<!--            </div>-->
<!--            <div class="chatContentDate">오후 3:01</div>-->
<!--          </div>-->
        </div>
        <footer>
          <div class="footerNav">
            <div class="submit-btn-wrap">
              <input
                type="text"
                class="input"
                onkeyup="enterkey()"
                id="opinion"
              />
              <a href="">
                <img
                  src="https://psk-s3-bucket.s3.ap-northeast-2.amazonaws.com/icons8-%ED%96%89%EB%B3%B5-48.png"
                  alt=""
                />
              </a>
              <button class="btn btn-danger sendTextButton" onclick="send()">
                전송
              </button>
            </div>
          </div>
        </footer>
      </div>
      <!-- 채팅 끝 -->
    </div>
    <script src="https://code.jquery.com/jquery-3.6.3.min.js"></script>
    <!-- api.js를 넣기 전에 꼭 jquery를 넣어야함 -->
    <script src="/js/api.js"></script>
    <script th:inline="javascript">
         let club = [[${club}]];
         let clubIdx = club.clubIdx;
         // 작성자 서호준
         // 가입 요청
         $(".join-btn").on("click", function () {
          let joinConfirm = confirm("가입하시겠습니까?");
          if(joinConfirm){
         	let data = {
         		memberIdx: 3, // 세션으로 넣어야 하지 않나?
         	};
         	let result = api.update("club", "waiting". clubIdx, data);
         	if (result == true) {
         		alert("신청완료!");
         	} else {
         		alert("이미 가입되어 있거나 신청서를 넣은 기록이 있습니다.");
         	}
         }
         });

          let memberIdx = 3;
         	let arr = [];
         	arr = club.clubGuest.split(",");
         	arr[0] = arr[0].slice(1);
         	arr[arr.length-1] = arr[arr.length-1].replace("}","");
         	for(value of arr){
         		if(value.trim() == memberIdx){
         			$(".join-btn").css("display", "none");
         			$(".outBtn").css("display","block");
         			$(".deleteChatting").css("display", "block");
         			$(".outChatting").css("display", "block");
         			$("#outClub").css("display", "block");
         			break;
         		}else{
         			$(".outBtn").css("display","none");
         			$(".join-btn").css("display", "block");
         		}
         	}

          // 탈퇴 요청
         $("#outClub").on("click", function () {
          let joinConfirm = confirm("탈퇴하시겠습니까?");
          if(joinConfirm){
         	let data = {
         		memberIdx: 3, // 세션으로 넣어야 하지 않나?
         	};
         	let result = api.removeOne("club", clubIdx, data);
         	if (result == true) {
         		alert("탈퇴 완료!");
         	} else {
         		alert("탈퇴 실패!");
         	}
         }
         });

         // 가입 승인
         $(".acceptBtn").on("click", function () {
         	let data = {
            accept: Yes,
         		memberIdx: 3, // 세션으로 넣어야 하지 않나?
         	};
         	let result = api.update("club", clubIdx, data);
         	if (result == true) {
         		alert("승인 완료!");
      history.go();
         	} else if(result == false) {
         		alert("승인 실패!");
      history.go();
         	}
         });

         // 가입 거부
           $(".acceptBtn").on("click", function () {
         	let data = {
            accept : No,
         		memberIdx: 3, // 세션으로 넣어야 하지 않나?
         	};
         	let result = api.update("club", clubIdx, data);
         	if (result == true) {
      history.go();
         	} else {
      history.go();
         	}
         });
    </script>
    <script th:inline="javascript">
      		// 작성자 서호준
      		let meeting = [[${meeting}]];
      		let nowDate = new Date();
      		nowDate = nowDate.getFullYear() + "-" + (nowDate.getMonth()+1) + "-" +nowDate.getDate();
      		nowDate = new Date(nowDate);
      		   for(let i =0; i< meeting.length; i++){
      				let value = meeting[i];
      				let meetingDate = new Date(value.meetingDate)
      				var weekday = new Array(7);
      				weekday[0] = "일";
      				weekday[1] = "월";
      				weekday[2] = "화";
      				weekday[3] = "수";
      				weekday[4] = "목";
      				weekday[5] = "금";
      				weekday[6] = "토";
      			let day = weekday[meetingDate.getDay()];
      			$(".day1").eq(i).text(day);
      			$(".day2").eq(i).text(day);
      			$(".howLong").eq(i).text((meetingDate.getMonth()+1) + '/' + meetingDate.getDate());
      			meetingDate = meetingDate.getFullYear() + "-" + (meetingDate.getMonth()+1) + "-" +meetingDate.getDate();
      		  meetingDate = new Date(meetingDate);
      			let dateDiff = Number( meetingDate.getTime()- nowDate.getTime()) / Number( 24 * 60 * 60 * 1000);

      			switch (dateDiff) {
      				case 1:
      					$(".howLong").text("내일");
      					break;
      				case 2:
      					$(".howLong").text("모래");
      					break;
      				case 0:
      					$(".howLong").text("오늘");
      					break;
      			}

      		$(".endTime").eq(i).text($(".endTime").text().substr(0,5));
      		$(".meetingMember").eq(i).text(value.meetingAttend.length);
      }
      let clubMemberNum = $(".desc_shop").length;
      $(".clubMemberNum").text(clubMemberNum);
      $(".memberNumber").text(clubMemberNum);
    </script>
    <script>
      function display(showObject) {
        const classContentNav = document.querySelector("#classContentNav");
        const classContentPhotoNav = document.querySelector(
          "#classContentPhotoNav"
        );
        const classContentChatNav = document.querySelector(
          "#classContentChatNav"
        );
        const classContent = document.querySelector("#classContent");
        const classContentPhoto = document.querySelector("#classContentPhoto");
        const classContentChat = document.querySelector("#classContentChat");

        classContentNav.classList.add("nav-disappear");
        classContentNav.classList.remove("nav-appear");
        classContentPhotoNav.classList.add("nav-disappear");
        classContentPhotoNav.classList.remove("nav-appear");
        classContentChatNav.classList.add("nav-disappear");
        classContentChatNav.classList.remove("nav-appear");
        classContent.classList.add("content-disappear");
        classContent.classList.remove("content-appear");
        classContentPhoto.classList.add("content-disappear");
        classContentPhoto.classList.remove("content-appear");
        classContentChat.classList.add("content-disappear");
        classContentChat.classList.remove("content-appear");

        if (showObject == "classContent") {
          classContentNav.classList.add("nav-appear");
          classContentNav.classList.remove("nav-disappear");
          classContent.classList.add("content-appear");
          classContent.classList.remove("content-disappear");
        } else if (showObject == "classContentPhoto") {
          classContentPhotoNav.classList.add("nav-appear");
          classContentPhotoNav.classList.remove("nav-disappear");
          classContentPhoto.classList.add("content-appear");
          classContentPhoto.classList.remove("content-disappear");
        } else if (showObject == "classContentChat") {
          classContentChatNav.classList.add("nav-appear");
          classContentChatNav.classList.remove("nav-disappear");
          classContentChat.classList.add("content-appear");
          classContentChat.classList.remove("content-disappear");
        }
      }
      function appearMenu() {
        const threeDotBackGround = document.querySelector(
          "#threeDotBackGround"
        );
        const threeDotContent = document.querySelector("#threeDotContent");
        threeDotBackGround.classList.add("threeDotBackGround");
        threeDotContent.classList.add("threeDotContent-appear");
        threeDotContent.classList.remove("threeDotContent-disappear");
      }
      function disappearMenu() {
        const threeDotBackGround = document.querySelector(
          "#threeDotBackGround"
        );
        const threeDotContent = document.querySelector("#threeDotContent");
        threeDotBackGround.classList.remove("threeDotBackGround");
        threeDotContent.classList.add("threeDotContent-disappear");
        threeDotContent.classList.remove("threeDotContent-appear");
      }
    </script>
    <script th:inline="javascript">

      let chattingList = [[${chattingList}]];
      let user = [[${user}]];
      let lastChatMemberIdx = chattingList[chattingList.length - 1].memberIdx;
      let lastChatDate = chattingList[chattingList.length - 1].chattingWriteTime;

      // ******************************* 채팅과 관련된 스크립트 *******************************

      var websocket = new WebSocket("ws://localhost:8080/ws/chat");
      websocket.onmessage = onMessage;
      websocket.onopen = onOpen;

      setInterval(() => console.log(new Date()), 60000); //prevent chrome refresh

      function enterkey(){
        if (window.event.keyCode == 13) {
          send();
        }
      }

      function send(){
        if($("#opinion").val() != ""){
          var sendItem = {clubIdx: "" + club.clubIdx,
                            memberIdx: "" + user.memberIdx,
                            memberName: user.memberName,
                            chattingType: "text",
                            chattingContent: $("#opinion").val()};
          websocket.send(JSON.stringify(sendItem));
          $("#opinion").val('');
        }
      }

      function onOpen(){
        var sendItem = {clubIdx: "" + club.clubIdx,
                          memberIdx: "" + user.memberIdx,
                          memberName: user.memberName,
                          chattingType: "open",
                          chattingContent: ""};
        websocket.send(JSON.stringify(sendItem));
      }

      function onMessage(msg) {
        console.log(JSON.parse(msg.data));

        var messageInfo = JSON.parse(msg.data);
        var str = '';

        // 날짜가 이전 사람과 다르면 날짜 넣어주기
        if (lastChatDate.split('T')[0] !== messageInfo.chattingWriteTime.split('T')[0]){
          str += '<div class="chatDateWrap">';
          str += '<div class="chatDate">';
          str += messageInfo.chattingWriteTime;
          str += '</div>';
          str += '</div>';
        }

        // 메세지 보낸 사람이 나이면 chatContentWrap class 넣어주기
        if (messageInfo.memberIdx == user.memberIdx){
          str += '<div class="chatContentWrap">';
        }else{ // 아니면 chatContentWrap2 넣어주기
          str += '<div class="chatContentWrap2">';
        }

        // 마지막으로 보낸 사람이 메세지를 보낸 사람이 아니면 이미지 넣어주기
        if (lastChatMemberIdx != messageInfo.memberIdx){
          str += '<img class="chatContentImg" src="https://www.knps.or.kr/upload/contest/21/20221108082032573.jpg"/>';
        }else{ // 아니면 이미지 안넣기
          str += '<div class="chatContentImg"></div>';
        }

        // 메세지 보낸 사람이 나이면 chatContentInfo class 넣어주기
        if (messageInfo.memberIdx == user.memberIdx){
          str += '<div class="chatContentInfo">';
        }else{ // 아니면 chatContentInfo2 넣어주기
          str += '<div class="chatContentInfo2">';
        }

        // 마지막으로 보낸 사람이 메세지를 보낸 사람이 아니면 이름 넣어주기
        if (lastChatMemberIdx != messageInfo.memberIdx){
          str += '<div class="chatContentName">';
          str += messageInfo.memberName;
          str += '</div>';
        }

        str += '<div class="chatContent">';
        str += messageInfo.chattingContent;
        str += '</div>';
        str += '</div>';
        str += '<div class="chatContentDate">';
        str += messageInfo.chattingWriteTime;
        str += '</div>';
        str += '</div>';

        $("#chat").append(str);
        lastChatMemberIdx = messageInfo.memberIdx;
        lastChatDate = messageInfo.chattingWriteTime;


        document.getElementById("chat").scrollTop = document.getElementById("chat").scrollHeight;
      }

    </script>
  </body>
</html>
